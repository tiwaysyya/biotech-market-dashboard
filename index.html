<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Biotech Market Landscape Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg-page: #f3f4f6;
      --bg-panel: #ffffff;
      --bg-soft: #f9fafb;
      --border-soft: #e5e7eb;

      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --accent-strong: #1d4ed8;

      --text-main: #111827;
      --text-soft: #6b7280;
      --text-faint: #9ca3af;

      --good: #059669;
      --bad: #dc2626;
      --watch: #d97706;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-page);
      color: var(--text-main);
      padding: 18px 14px 32px;
      font-size: 14px;
    }

    .page {
      max-width: 1150px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 14px;
    }

    h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .frame {
      background: var(--bg-panel);
      border: 1px solid var(--border-soft);
      border-radius: 10px;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.08);
      padding: 16px 16px 20px;
    }

    .top-row {
      display: grid;
      grid-template-columns: 2fr 1.25fr;
      gap: 12px;
      margin-bottom: 14px;
    }

    @media (max-width: 900px) {
      .top-row {
        grid-template-columns: 1fr;
      }
    }

    .section-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-faint);
      margin-bottom: 6px;
    }

    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    @media (max-width: 720px) {
      .kpi-grid {
        grid-template-columns: 1fr;
      }
    }

    .kpi-card {
      position: relative;
      padding: 14px 14px 12px;
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      box-shadow: 0 4px 14px rgba(0,0,0,0.08);
      transition: box-shadow 0.2s ease, transform 0.2s ease;
    }

    .kpi-card:hover {
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      transform: translateY(-2px);
    }

    .kpi-card-strip {
      height: 4px;
      border-radius: 999px;
      margin-bottom: 10px;
    }

    .kpi-card-tam .kpi-card-strip {
      background: linear-gradient(90deg, #bbf7d0, #16a34a);
    }

    .kpi-card-cagr .kpi-card-strip {
      background: linear-gradient(90deg, #bfdbfe, #2563eb);
    }

    .kpi-card-conviction .kpi-card-strip {
      background: linear-gradient(90deg, #fed7aa, #f97316);
    }

    .kpi-label {
      font-size: 13px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .kpi-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    .kpi-sub {
      font-size: 14px;
      color: #4b5563;
    }

    .filters {
      background: var(--bg-soft);
      padding: 10px 12px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .filters-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-faint);
    }

    .select {
      border-radius: 6px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      padding: 6px 8px;
      font-size: 13px;
      color: var(--text-main);
      outline: none;
      width: 100%;
    }

    button {
      padding: 6px 11px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-main);
      transition: background 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
    }

    button:hover {
      background: var(--accent-soft);
      border-color: #bfdbfe;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .pill-row button {
      flex: 0 0 auto;
      white-space: nowrap;
    }

    .pill-row button.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #f9fafb;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.35);
    }

    .filters-note {
      font-size: 11px;
      color: var(--text-soft);
    }

    .layout-main {
      margin-top: 12px;
      display: grid;
      grid-template-columns: 1.65fr 1.35fr;
      gap: 12px;
    }

    @media (max-width: 900px) {
      .layout-main {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--bg-soft);
      padding: 9px 10px 10px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 6px;
      margin-bottom: 6px;
    }

    .panel-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-faint);
    }

    .panel-subtitle {
      font-size: 11px;
      color: var(--text-soft);
      text-align: right;
    }

    .area-list {
      max-height: 340px;
      overflow-y: auto;
      margin-top: 4px;
      padding-right: 4px;
    }

    .area-card {
      background: #ffffff;
      padding: 7px 8px;
      margin-bottom: 6px;
      border-radius: 6px;
      border: 1px solid transparent;
      display: grid;
      grid-template-columns: 1.8fr 1.2fr 1fr;
      gap: 6px;
      align-items: center;
      cursor: pointer;
      transition: border-color 0.1s ease, background 0.1s ease, box-shadow 0.1s ease;
    }

    @media (max-width: 720px) {
      .area-card {
        grid-template-columns: 1.7fr 1.3fr;
      }
    }

    .area-card:hover {
      border-color: #cbd5e1;
      background: #f8fafc;
    }

    .area-card.active {
      border-color: var(--accent);
      box-shadow: 0 2px 7px rgba(15, 23, 42, 0.16);
      background: #eff6ff;
    }

    .area-name {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .area-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .chip {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      font-size: 10px;
      white-space: nowrap;
    }

    .chip-enter {
      background: #ecfdf5;
      color: var(--good);
      border-color: var(--good);
    }

    .chip-partner {
      background: #e0ecff;
      color: var(--accent-strong);
      border-color: var(--accent-strong);
    }

    .chip-watch {
      background: #fff7ed;
      color: var(--watch);
      border-color: var(--watch);
    }

    .chip-bad {
      background: #fef2f2;
      color: var(--bad);
      border-color: var(--bad);
    }

    .area-metrics {
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .area-score {
      text-align: right;
      font-size: 11px;
    }

    .score-value {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .score-bar {
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .score-bar-inner {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-soft), var(--accent));
      width: 0%;
    }

    .detail-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .detail-sub {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 6px;
    }

    .detail-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-faint);
      margin-top: 6px;
      margin-bottom: 2px;
    }

    .detail-body {
      font-size: 13px;
    }

    .mini-chart {
      margin-top: 4px;
    }

    .mini-bar-row {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .mini-bar-label {
      width: 170px;
      color: var(--text-main);
      font-size: 15px;
    }

    .mini-bar-track {
      flex: 1;
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .mini-bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent-soft), var(--accent));
      width: 0%;
    }

    .strategy-row {
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1.6fr 1.2fr;
      gap: 12px;
    }

    @media (max-width: 900px) {
      .strategy-row {
        grid-template-columns: 1fr;
      }
    }

    .quadrant {
      background: #ffffff;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      position: relative;
    }

    .quadrant-inner {
      position: relative;
      width: 100%;
      padding-bottom: 100%;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
      background-image:
        linear-gradient(to right, #e5e7eb 1px, transparent 1px),
        linear-gradient(to bottom, #e5e7eb 1px, transparent 1px);
      background-size: 25% 25%;
      overflow: hidden;
    }

    .quadrant-axes {
      display: flex;
      justify-content: space-between;
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .quadrant-y-caption {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 11px;
      color: var(--text-soft);
    }

    @keyframes pointPop {
      0%   { transform: translate(-50%, -50%) scale(0.4); opacity: 0; }
      60%  { transform: translate(-50%, -50%) scale(1.08); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .quadrant-point {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      border: 2px solid #ffffff;
      box-shadow: 0 0 3px rgba(15, 23, 42, 0.35);
      transform: translate(-50%, -50%);
      cursor: pointer;
      animation: pointPop 0.35s ease-out;
    }

    .quad-enter { background: var(--good); }
    .quad-partner { background: var(--accent); }
    .quad-watch { background: var(--watch); }
    .quad-avoid { background: var(--bad); }

    .quadrant-legend {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .quad-legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .quad-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      border: 1px solid #ffffff;
      box-shadow: 0 0 2px rgba(15, 23, 42, 0.35);
    }

    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-soft);
      text-align: right;
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <h1>Biotech Market Landscape</h1>
    <div class="subtitle">Equity research and strategic opportunity scan</div>
  </header>

  <div class="frame">
    <div class="top-row">
      <section>
        <div class="section-title">Market snapshot</div>
        <div id="kpiGrid" class="kpi-grid"></div>
      </section>

      <aside class="filters">
        <div class="filters-row">
          <div class="label">Persona</div>
          <select id="personaSelect" class="select">
            <option value="founder">Biotech founder</option>
            <option value="investor">Life sciences investor</option>
            <option value="bigpharma">Big pharma BD</option>
            <option value="consulting">Strategy consulting</option>
          </select>
        </div>

        <div class="filters-row">
          <div class="label">Recommended play</div>
          <div id="playFilterRow" class="pill-row">
            <button data-play="all" class="active">All areas</button>
            <button data-play="enter">Enter</button>
            <button data-play="partner">Partner</button>
            <button data-play="watch">Watch</button>
            <button data-play="avoid">Avoid</button>
          </div>
        </div>

        <div class="filters-row">
          <div class="label">Modality focus</div>
          <div id="modalityFilterRow" class="pill-row">
            <button data-modality="all" class="active">All</button>
            <button data-modality="small">Small molecule</button>
            <button data-modality="bio">Biologicals</button>
            <button data-modality="cellgene">Cell and gene</button>
            <button data-modality="rna">RNA</button>
          </div>
        </div>

        <div class="filters-note">
          Filters change which areas are surfaced and how the attractiveness scores are interpreted.
        </div>
      </aside>
    </div>

    <div class="layout-main">
      <section class="panel">
        <div class="panel-header">
          <div class="panel-title">Therapeutic area heatmap</div>
          <div id="resultsSummary" class="panel-subtitle"></div>
        </div>
        <div id="areaList" class="area-list"></div>
      </section>

      <aside class="panel">
        <div class="panel-header">
          <div class="panel-title">Area detail view</div>
        </div>
        <div id="detailPanel">
          <div class="detail-sub">
            Select a therapeutic area on the left to see market context, feasibility and recommended play.
          </div>
        </div>
      </aside>
    </div>

    <div class="strategy-row">
      <section class="panel">
        <div class="panel-header">
          <div class="panel-title">Attractiveness vs feasibility</div>
          <div class="panel-subtitle">Equity research lens</div>
        </div>
        <div class="quadrant">
          <div class="quadrant-y-caption">Higher attractiveness ↑</div>
          <div id="quadrantInner" class="quadrant-inner"></div>
          <div class="quadrant-axes">
            <span>Lower feasibility ←</span>
            <span>Higher feasibility →</span>
          </div>
        </div>
        <div class="quadrant-legend">
          <div class="quad-legend-item"><span class="quad-dot quad-enter"></span>Enter</div>
          <div class="quad-legend-item"><span class="quad-dot quad-partner"></span>Partner</div>
          <div class="quad-legend-item"><span class="quad-dot quad-watch"></span>Watch</div>
          <div class="quad-legend-item"><span class="quad-dot quad-avoid"></span>Avoid</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <div class="panel-title">Risk and timing snapshot</div>
          <div class="panel-subtitle">Filtered set</div>
        </div>
        <div id="riskChart" class="mini-chart"></div>
      </section>
    </div>

    <div class="footer-note">
      Figures are directional and simplified for strategic discussion, not investment advice.
    </div>
  </div>
</div>

<script>
  const areas = [
    {
      id: "onco_io",
      name: "Oncology – Immuno oncology",
      segment: "Oncology",
      modalities: ["bio", "cellgene"],
      tamUSD: 85,
      cagr: 11.5,
      trials: 1450,
      competition: 9.2,
      unmetNeed: 8.5,
      pricingPower: 8.0,
      dealActivity: 9.0,
      investorMomentum: 8.8,
      recommendation: "partner",
      timeToMarket: 6.0,
      probSuccess: 0.18,
      clinicalRisk: 8.0,
      phaseCost: 8.5,
      cashNeed: 8.0,
      rationaleShort: "Crowded but still valuable for differentiated mechanisms and smart combinations.",
      personaNotes: {
        founder: "Differentiation is everything. Biomarkers, niche indications and combo rationale are essential.",
        investor: "Look for clear stratification, fast proof of concept and de risked endpoints.",
        bigpharma: "Partner for late stage assets that plug into your oncology footprint.",
        consulting: "Portfolio pruning, indication selection and BD screening are common asks."
      }
    },
    {
      id: "rare_metabolic",
      name: "Rare metabolic disease",
      segment: "Rare disease",
      modalities: ["bio", "cellgene"],
      tamUSD: 22,
      cagr: 13.0,
      trials: 320,
      competition: 4.0,
      unmetNeed: 9.4,
      pricingPower: 9.2,
      dealActivity: 7.5,
      investorMomentum: 7.8,
      recommendation: "enter",
      timeToMarket: 5.0,
      probSuccess: 0.24,
      clinicalRisk: 6.0,
      phaseCost: 7.0,
      cashNeed: 7.0,
      rationaleShort: "High unmet need with strong pricing tolerance and manageable competition.",
      personaNotes: {
        founder: "Strong natural history data and KOL backing are critical.",
        investor: "Platform stories that span multiple indications are attractive.",
        bigpharma: "Bolt on acquisitions diversify revenue and improve resilience.",
        consulting: "Classic space for launch strategy, HEOR and access modelling."
      }
    },
    {
      id: "autoimmune_bio",
      name: "Autoimmune – Biologic therapies",
      segment: "Autoimmune",
      modalities: ["bio"],
      tamUSD: 70,
      cagr: 8.0,
      trials: 760,
      competition: 8.7,
      unmetNeed: 7.0,
      pricingPower: 7.3,
      dealActivity: 7.8,
      investorMomentum: 7.0,
      recommendation: "partner",
      timeToMarket: 4.5,
      probSuccess: 0.22,
      clinicalRisk: 5.5,
      phaseCost: 6.5,
      cashNeed: 6.0,
      rationaleShort: "Large established markets with biosimilar pressure and room for best in class plays.",
      personaNotes: {
        founder: "Differentiation on convenience, safety and payer economics matters more than novel biology.",
        investor: "Real world data and switching dynamics matter as much as trials.",
        bigpharma: "Partnerships help refresh ageing franchises and protect share.",
        consulting: "Ongoing work in segmentation, brand strategy and access optimisation."
      }
    },
    {
      id: "cell_therapy_heme",
      name: "Cell therapy – Haematologic cancers",
      segment: "Cell and gene therapy",
      modalities: ["cellgene"],
      tamUSD: 18,
      cagr: 23.0,
      trials: 410,
      competition: 7.0,
      unmetNeed: 8.0,
      pricingPower: 8.5,
      dealActivity: 8.7,
      investorMomentum: 8.2,
      recommendation: "partner",
      timeToMarket: 6.5,
      probSuccess: 0.16,
      clinicalRisk: 8.5,
      phaseCost: 9.0,
      cashNeed: 9.0,
      rationaleShort: "High complexity favours platforms, networks and partnerships.",
      personaNotes: {
        founder: "Manufacturing, COGS and centre of excellence adoption are as important as the science.",
        investor: "Platform scalability and partnering appetite can matter more than single assets.",
        bigpharma: "Partnership slots for co development and regional rights remain attractive.",
        consulting: "Network design, capacity planning and launch sequencing are common projects."
      }
    },
    {
      id: "rna_rare",
      name: "RNA therapeutics – Rare and niche indications",
      segment: "RNA therapeutics",
      modalities: ["rna"],
      tamUSD: 15,
      cagr: 20.0,
      trials: 180,
      competition: 5.0,
      unmetNeed: 8.7,
      pricingPower: 8.2,
      dealActivity: 8.3,
      investorMomentum: 8.9,
      recommendation: "enter",
      timeToMarket: 4.0,
      probSuccess: 0.23,
      clinicalRisk: 6.0,
      phaseCost: 7.5,
      cashNeed: 8.0,
      rationaleShort: "Emerging modality with strong momentum in genetically defined populations.",
      personaNotes: {
        founder: "Sharpen the story on delivery, durability and manufacturing.",
        investor: "Platform breadth and repeatable indication expansion are key.",
        bigpharma: "Partnerships de risk modality exposure while preserving optionality.",
        consulting: "Great space for indication prioritisation and partner search work."
      }
    },
    {
      id: "neuro_deg",
      name: "Neurodegeneration",
      segment: "Neurology",
      modalities: ["small", "bio"],
      tamUSD: 55,
      cagr: 9.5,
      trials: 520,
      competition: 7.2,
      unmetNeed: 9.5,
      pricingPower: 7.8,
      dealActivity: 7.0,
      investorMomentum: 6.5,
      recommendation: "watch",
      timeToMarket: 7.0,
      probSuccess: 0.12,
      clinicalRisk: 9.0,
      phaseCost: 8.0,
      cashNeed: 8.0,
      rationaleShort: "Huge burden and recent wins, but biology remains complex and risky.",
      personaNotes: {
        founder: "Biomarkers and stratification are non negotiable.",
        investor: "Trial design and evidence quality matter more than indication hype.",
        bigpharma: "Selective entry with de risked or fast follower assets.",
        consulting: "High demand for market shaping, access and evidence strategy."
      }
    },
    {
      id: "metabolic_obesity",
      name: "Metabolic – Obesity and NASH",
      segment: "Metabolic",
      modalities: ["small", "bio"],
      tamUSD: 90,
      cagr: 14.0,
      trials: 430,
      competition: 8.5,
      unmetNeed: 8.0,
      pricingPower: 7.5,
      dealActivity: 9.2,
      investorMomentum: 9.5,
      recommendation: "watch",
      timeToMarket: 5.0,
      probSuccess: 0.20,
      clinicalRisk: 7.5,
      phaseCost: 7.5,
      cashNeed: 8.0,
      rationaleShort: "Explosive growth, but space is consolidating around a few heavyweights.",
      personaNotes: {
        founder: "Focus on niches, combinations and adjacencies rather than head on GLP 1 competition.",
        investor: "Enabling technologies and services may be more attractive than another incretin.",
        bigpharma: "Lifecycle, combos and adjacent cardiometabolic plays are key.",
        consulting: "Rich ground for scenario modelling, payer impact work and capacity planning."
      }
    },
    {
      id: "antiinfectious",
      name: "Novel antibiotics and anti infectives",
      segment: "Anti infectives",
      modalities: ["small"],
      tamUSD: 12,
      cagr: 5.0,
      trials: 150,
      competition: 4.5,
      unmetNeed: 9.0,
      pricingPower: 3.5,
      dealActivity: 4.0,
      investorMomentum: 3.0,
      recommendation: "avoid",
      timeToMarket: 8.0,
      probSuccess: 0.10,
      clinicalRisk: 8.0,
      phaseCost: 5.0,
      cashNeed: 7.0,
      rationaleShort: "High unmet need but commercial model remains broken without pull incentives.",
      personaNotes: {
        founder: "Only viable with innovative reimbursement, pooled purchasing or non traditional partnerships.",
        investor: "Impact driven mandates may participate, but risk reward is tough for generalist capital.",
        bigpharma: "Low appetite except for stewardship or policy driven collaborations.",
        consulting: "Policy, incentive design and ecosystem work dominate over classic brand projects."
      }
    }
  ];

  // KPI calculation
  function computeKpis(list) {
    let tam = 0, weightedCagr = 0, weight = 0, highConviction = 0;

    list.forEach(a => {
      tam += a.tamUSD;
      weightedCagr += a.cagr * a.tamUSD;
      weight += a.tamUSD;
      if (["enter", "partner"].includes(a.recommendation)) highConviction++;
    });

    return {
      tam,
      cagr: weight ? weightedCagr / weight : 0,
      highConviction
    };
  }

  // Attractiveness score
  function computeAttractiveness(a) {
    const growth = Math.min(a.cagr / 3, 10);
    const tam = Math.min(a.tamUSD / 12, 10);
    const competitionPenalty = 10 - a.competition * 0.7;

    return Math.max(2, Math.min(10,
      growth * 0.2 +
      tam * 0.2 +
      competitionPenalty * 0.15 +
      a.unmetNeed * 0.2 +
      a.investorMomentum * 0.25
    ));
  }

  // Feasibility (equity research lens)
  function computeFeasibility(a) {
    const success = a.probSuccess * 10;
    const timeScore = Math.max(0, Math.min(10, 10 - (a.timeToMarket - 3) * 1.3));
    const risk = 10 - a.clinicalRisk;
    const cost = 10 - a.phaseCost;
    const cash = 10 - a.cashNeed;

    return Math.max(1.5, Math.min(9.5,
      success * 0.3 +
      timeScore * 0.2 +
      risk * 0.2 +
      cost * 0.15 +
      cash * 0.15
    ));
  }

  // Filter state
  let activePlay = "all";
  let activeModality = "all";
  let activePersona = "founder";
  let activeArea = null;

  function applyFilters() {
    return areas.filter(a => {
      if (activePlay !== "all" && a.recommendation !== activePlay) return false;
      if (activeModality !== "all" && !a.modalities.includes(activeModality)) return false;
      return true;
    });
  }

  // KPI rendering with strips and animated count
  function renderKpis(list) {
    const k = computeKpis(list);

    document.getElementById("kpiGrid").innerHTML = `
      <div class="kpi-card kpi-card-tam">
        <div class="kpi-card-strip"></div>
        <div class="kpi-label">Total addressable market</div>
        <div class="kpi-value">
          $<span class="kpi-number" data-type="int" data-target="${k.tam}">0</span>B+
        </div>
        <div class="kpi-sub">Summed across segments</div>
      </div>

      <div class="kpi-card kpi-card-cagr">
        <div class="kpi-card-strip"></div>
        <div class="kpi-label">Weighted TAM growth</div>
        <div class="kpi-value">
          <span class="kpi-number" data-type="float" data-target="${k.cagr.toFixed(1)}">0.0</span>% CAGR
        </div>
        <div class="kpi-sub">Segment weighted</div>
      </div>

      <div class="kpi-card kpi-card-conviction">
        <div class="kpi-card-strip"></div>
        <div class="kpi-label">High conviction</div>
        <div class="kpi-value">
          <span class="kpi-number" data-type="int" data-target="${k.highConviction}">0</span> areas
        </div>
        <div class="kpi-sub">Enter/partner</div>
      </div>
    `;

    animateKpiNumbers();
  }

  function animateKpiNumbers() {
    const elements = document.querySelectorAll(".kpi-number");
    const duration = 900;
    const easeOut = t => 1 - Math.pow(1 - t, 3);

    elements.forEach(el => {
      const target = parseFloat(el.dataset.target);
      const type = el.dataset.type;
      const start = performance.now();

      function update(now) {
        const progress = Math.min(1, (now - start) / duration);
        const eased = easeOut(progress);
        const value = target * eased;

        if (type === "float") {
          el.textContent = value.toFixed(1);
        } else {
          el.textContent = Math.round(value);
        }

        if (progress < 1) requestAnimationFrame(update);
      }

      requestAnimationFrame(update);
    });
  }

  // Heatmap list
  function renderAreaList(list) {
    const box = document.getElementById("areaList");
    document.getElementById("resultsSummary").textContent = `${list.length} areas shown`;
    box.innerHTML = "";

    list.forEach(a => {
      const attract = computeAttractiveness(a);

      const card = document.createElement("div");
      card.className = "area-card";
      if (a.id === activeArea) card.classList.add("active");

      card.innerHTML = `
        <div>
          <div class="area-name">${a.name}</div>
          <div class="area-tags">
            <span class="chip">${a.segment}</span>
            <span class="chip chip-${a.recommendation}">${recommendLabel(a.recommendation)}</span>
          </div>
        </div>
        <div class="area-metrics">
          TAM ~ $${a.tamUSD}B
          <br>Growth ~ ${a.cagr}% CAGR
          <br>Trials ~ ${a.trials}+
        </div>
        <div class="area-score">
          <div class="score-value">${attract.toFixed(1)}/10</div>
          <div class="score-bar">
            <div class="score-bar-inner" style="width:${attract * 10}%"></div>
          </div>
        </div>
      `;

      card.onclick = () => {
        activeArea = a.id;
        renderAll();
      };

      box.appendChild(card);
    });
  }

  function recommendLabel(r) {
    if (r === "enter") return "Enter";
    if (r === "partner") return "Partner";
    if (r === "watch") return "Watch closely";
    if (r === "avoid") return "Avoid";
    return r;
  }

  // Detail panel
  function renderDetail(area) {
    if (!area) {
      document.getElementById("detailPanel").innerHTML =
        "<div class='detail-sub'>Select a therapeutic area to view details.</div>";
      return;
    }

    const feas = computeFeasibility(area);

    document.getElementById("detailPanel").innerHTML = `
      <div class="detail-title">${area.name}</div>
      <div class="detail-sub">${area.rationaleShort}</div>

      <div class="badge-row">
        <span class="chip">${area.segment}</span>
        <span class="chip">Modalities: ${area.modalities.join(", ")}</span>
        <span class="chip chip-${area.recommendation}">${recommendLabel(area.recommendation)}</span>
      </div>

      <div class="detail-label">Market context</div>
      <div class="detail-body">
        TAM ~ $${area.tamUSD}B, ${area.cagr}% CAGR,
        ${area.trials}+ trials, competition score ${area.competition}/10.
      </div>

      <div class="detail-label">Strategic angle</div>
      <div class="detail-body">${area.personaNotes[activePersona]}</div>

      <div class="detail-label">Feasibility score (equity lens)</div>
      <div class="detail-body">${feas.toFixed(1)}/10</div>

      <div class="detail-label">Key drivers</div>
      <div class="mini-chart">
        ${miniBar("Unmet need", area.unmetNeed)}
        ${miniBar("Pricing power", area.pricingPower)}
        ${miniBar("Deal activity", area.dealActivity)}
        ${miniBar("Investor momentum", area.investorMomentum)}
      </div>
    `;
  }

  function miniBar(label, value) {
    return `
      <div class="mini-bar-row">
        <div class="mini-bar-label">${label}</div>
        <div class="mini-bar-track">
          <div class="mini-bar-fill" style="width:${value * 10}%"></div>
        </div>
        <div style="width:52px; font-size:13px; text-align:right; color:#4b5563;">
          ${value.toFixed(1)}
        </div>
      </div>
    `;
  }

  // Quadrant
  function renderQuadrant(list) {
    const box = document.getElementById("quadrantInner");
    box.innerHTML = "";

    list.forEach(a => {
      const attract = computeAttractiveness(a);
      const feas = computeFeasibility(a);

      const dot = document.createElement("div");
      dot.className = `quadrant-point quad-${a.recommendation}`;
      dot.style.left = `${(feas / 10) * 100}%`;
      dot.style.top = `${100 - (attract / 10) * 100}%`;
      dot.title = `${a.name}
Attractiveness: ${attract.toFixed(1)}
Feasibility: ${feas.toFixed(1)}`;

      dot.onclick = () => {
        activeArea = a.id;
        renderAll();
      };

      box.appendChild(dot);
    });
  }

  // Risk chart
  function renderRiskChart(list) {
    const c = document.getElementById("riskChart");
    c.innerHTML = "";

    if (!list.length) {
      c.textContent = "No areas selected.";
      return;
    }

    const avgProb = list.reduce((s, a) => s + a.probSuccess, 0) / list.length;
    const avgTime = list.reduce((s, a) => s + a.timeToMarket, 0) / list.length;
    const avgRisk = list.reduce((s, a) => s + a.clinicalRisk, 0) / list.length;

    const rows = [
      { label: "Probability of success", value: avgProb * 100, max: 100, display: avgProb * 100, unit: "%" },
      { label: "Time to market", value: avgTime, max: 10, display: avgTime, unit: "yrs" },
      { label: "Clinical risk", value: avgRisk, max: 10, display: avgRisk, unit: "/10" }
    ];

    rows.forEach(r => {
      const row = document.createElement("div");
      row.className = "mini-bar-row";

      const label = document.createElement("div");
      label.className = "mini-bar-label";
      label.textContent = r.label;

      const track = document.createElement("div");
      track.className = "mini-bar-track";

      const fill = document.createElement("div");
      fill.className = "mini-bar-fill";
      fill.style.width = Math.max(8, Math.min(100, (r.value / r.max) * 100)) + "%";
      track.appendChild(fill);

      const valueEl = document.createElement("div");
      valueEl.style.width = "60px";
      valueEl.style.textAlign = "right";
      valueEl.style.fontSize = "13px";
      valueEl.style.color = "#4b5563";
      valueEl.textContent =
        r.unit === "%"
          ? r.display.toFixed(0) + "%"
          : r.display.toFixed(1) + " " + r.unit;

      row.appendChild(label);
      row.appendChild(track);
      row.appendChild(valueEl);

      c.appendChild(row);
    });
  }

  // Filter handlers
  document.getElementById("playFilterRow").onclick = e => {
    if (e.target.tagName !== "BUTTON") return;
    document.querySelectorAll("#playFilterRow button").forEach(b => b.classList.remove("active"));
    e.target.classList.add("active");
    activePlay = e.target.dataset.play;
    renderAll();
  };

  document.getElementById("modalityFilterRow").onclick = e => {
    if (e.target.tagName !== "BUTTON") return;
    document.querySelectorAll("#modalityFilterRow button").forEach(b => b.classList.remove("active"));
    e.target.classList.add("active");
    activeModality = e.target.dataset.modality;
    renderAll();
  };

  document.getElementById("personaSelect").onchange = e => {
    activePersona = e.target.value;
    renderAll();
  };

  // Main render
  function renderAll() {
    const filtered = applyFilters();
    renderKpis(filtered);
    renderAreaList(filtered);
    renderDetail(areas.find(a => a.id === activeArea));
    renderQuadrant(filtered);
    renderRiskChart(filtered);
  }

  renderAll();
</script>

</body>
</html>



